#!/bin/bash

#PBS -l ppn=6
#PBS -l walltime=10:00:00

if [ `which singularity` ]
then
    echo "running via singularity"
    time srun singularity run docker://brainlife/life
else
    [ `which module` ] && module load matlab ccm
    export MATLABPATH=$MATLABPATH:$PWD

    if [ `which ccmrun` ]
    then
        echo "running matlab via ccmrun"
        time ccmrun matlab -nodisplay -nosplash -r main
    else
        echo "running matlab"
        time matlab -nodisplay -nosplash -r main
    fi
fi

#make sure output_fe.mat exists
if [ ! -s output_fe.mat ];
then
	echo "output_fe.mat missing"
	exit 1
fi


